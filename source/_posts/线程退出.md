---
title: 线程退出
categories: [linux,线程进程]
---

----------

## 线程退出函数

在创建进程时，进程一般写为死循环，那么在创建子线程之后，子线程和主线程会进行抢占，当我们不需要某个线程时我们可以调用线程退出函数来退出线程，子线程和主线程都可以调用这个函数，线程退出函数的原型为：

~~~c
#include <pthread.h>
void pthread_exit(void *retval);
~~~

- 参数
  - retval：线程退出的时候携带的数据，当前子线程的主线程会得到该数据。如果不需要使用，指定为 NULL

## 创建退出实例

~~~c
#include <stdlib.h>
#include <stdio.h>
#include <unistd.h>
#include <pthread.h>

void *callback(void* arg)
{
    printf("我是子线程, 线程ID：%lu\r\n",pthread_self());
    int i = 0;
    while(i<5)
    {
        i++;
        printf("子程序运行%d次\r\n",i);
    }
    return NULL;
}

int main()
{
    pthread_t tid;
   	pthread_create(&tid, NULL, callback, NULL);//创建子线程，子线程处理函数为callback，传递参数为NULL，属性为NULL
    printf("子线程创建成功, 线程ID: %lu\r\n", tid);
    printf("我是主线程, 线程ID: %lu\r\n", pthread_self());
    //主线程阻塞1秒
    sleep(1);
    //退出主线程，但是地址空间不会被回收
    int i = 0;
    while(i<5)
    {
        i++;
        printf("主程序运行%d次\r\n",i);
        pthread_exit(NULL);
    }
    return 0;
}
~~~

主线程在执行第一次的时候就会退出，但是进程地址空间并不会被回收，在等待子线程执行完毕后，操作系统才会把进程的资源进行回收
